{#
  Copyright: (c) 2014 by Petr Zemek <s3rvac@gmail.com> and contributors
  License: BSD, see LICENSE for more details
#}

{% extends "base.html" %}

{% macro display_commit(commit) -%}
	<div class="commit">
		<div class="commit-hash">
			{% if commit_details_url_fmt %}
				<a href="{{ commit_details_url_fmt.format(commit.hash) }}">[{{ commit.short_hash() }}]</a>
			{% else %}
				{{ commit.short_hash() }}
			{% endif %}
		</div>
		<div class="commit-date">
			{{ commit.date|date }}
		</div>
		<div class="commit-author-email">
			<a href="mailto:{{ commit.email }}">{{ commit.author }}</a>
		</div>
		<div class="commit-subject" title="{{ commit.subject }}">
			{{ commit.short_subject() }}
		</div>
	</div>
{%- endmacro %}

{% macro display_branch(branch) -%}
	<div class="branch">
		<div class="branch-title">
			<span class="branch-name">{{ branch.name }}</span>
			<span class="branch-age">(last updated {{ branch.age|age }} ago)</span>
		</div>
		<div class="branch-commit">
			<div class="branch-commit-title">
			Current commit:
			</div>
			<div class="branch-commit-body">
				{{ display_commit(branch.commit) }}
			</div>
		</div>
		{% if branch.has_unmerged_commits(master_branch) %}
			<div class="branch-unmerged-commits">
				<div class="branch-unmerged-commits-title">
					Unmerged commits{% if unmerged_commits_limit %}
						(limit: {{ unmerged_commits_limit }}){% endif %}:
				</div>
				<div class="branch-unmerged-commits-list">
					{% for commit in branch.unmerged_commits(master_branch, unmerged_commits_limit) %}
						{{ display_commit(commit) }}
					{% endfor %}
				</div>
			</div>
		{% else %}
			<div class="branch-no-unmerged-commits">
				No unmerged commits.
			</div>
		{% endif %}
	</div>
{%- endmacro %}

{% block body %}
<h1>Branches In '{{ repo_name }}' On '{{ remote }}'</h1>

{% for branch in shown_branches %}
	{{ display_branch(branch) }}
{% endfor %}

<h2>Ignored</h2>
<ul>
	{% for branch in ignored_branches %}
	<li>
		{{ branch.name }}
	</li>
	{% endfor %}
</ul>
{% endblock %}
